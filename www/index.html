<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quality Analysis Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div id="loading" class="fixed inset-0 flex items-center justify-center bg-white">
        <div class="text-center">
            <p class="text-lg">Loading Dashboard...</p>
            <div id="status" class="text-sm text-gray-600 mt-2"></div>
        </div>
    </div>

    <div id="dashboard" class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold mb-8">Quality Analysis Dashboard</h1>
        
        <div class="mb-8">
            <h2 class="text-2xl font-semibold mb-4">Product Information</h2>
            <div id="product-content" class="bg-white shadow rounded-lg p-6"></div>
        </div>
        
        <div class="mb-8">
            <h2 class="text-2xl font-semibold mb-4">Purity Data</h2>
            <div id="purity-content" class="bg-white shadow rounded-lg p-6"></div>
        </div>
        
        <div class="mb-8">
            <h2 class="text-2xl font-semibold mb-4">Potency Data</h2>
            <div id="potency-content" class="bg-white shadow rounded-lg p-6"></div>
        </div>
        
        <div class="mb-8">
            <h2 class="text-2xl font-semibold mb-4">Activity Data</h2>
            <div id="activity-content" class="bg-white shadow rounded-lg p-6"></div>
        </div>
    </div>

    <script type="module">
        import init, { initialize_dashboard, update_purity_data, update_potency_data, update_activity_data } from './pkg/dashboard.js';

        // Constants
        const PRODUCT_INFO = {
            manufacturer: 'Master Supplements',
            product: 'Theralac',
            lotNumber: '07231A',
            manufacturingDate: '2023-07-23',
            expirationDate: '2024-07-23',
            productCode: 'TH-1000',
            batchSize: '10,000 units',
            storageConditions: '2-8Â°C',
            testDate: '2023-08-01'
        };

        const PURITY_DATA = [
            {
                description: 'Coliforms',
                specification: '<100 CFU/GM',
                result: '<100 CFU/GM',
                method: 'AOAC 991.14',
                pass_fail: 'Pass',
                evaluation: 'Microbial'
            },
            {
                description: 'E. Coli',
                specification: 'Negative/10GM',
                result: 'Negative/10GM',
                method: 'AOAC 991.14',
                pass_fail: 'Pass',
                evaluation: 'Microbial'
            },
            {
                description: 'Salmonella',
                specification: 'Negative/10GM',
                result: 'Negative/10GM',
                method: 'AOAC 2013.09',
                pass_fail: 'Pass',
                evaluation: 'Microbial'
            },
            {
                description: 'Staphylococcus aureus',
                specification: 'Negative/10GM',
                result: 'Negative/10GM',
                method: 'AOAC 2003.11',
                pass_fail: 'Pass',
                evaluation: 'Microbial'
            }
        ];

        const POTENCY_DATA = [
            {
                strain: 'Lactobacillus acidophilus (LA-1)',
                specification: 10.0,
                result: 15.2
            },
            {
                strain: 'Bifidobacterium lactis (BL-04)',
                specification: 10.0,
                result: 12.8
            },
            {
                strain: 'Lactobacillus rhamnosus (LR-32)',
                specification: 2.0,
                result: 3.5
            },
            {
                strain: 'Lactobacillus paracasei (LPC-37)',
                specification: 5.0,
                result: 7.2
            }
        ];

        const ACTIVITY_DATA = [
            {
                time: '0h',
                ph: 6.7,
                lactic_acid: 0.03
            },
            {
                time: '4h',
                ph: 5.5,
                lactic_acid: 0.25
            },
            {
                time: '8h',
                ph: 4.3,
                lactic_acid: 1.02
            },
            {
                time: '12h',
                ph: 3.9,
                lactic_acid: 1.56
            }
        ];
         
        // Initialize dashboard
        async function initializeDashboard() {
            try {
                console.log("Loading WASM module...");
                await init();
                console.log("Initializing WASM...");
                initialize_dashboard();
                
                console.log("Loading data...");
                renderProductInfo();
                renderPurityData();
                renderPotencyData();
                renderActivityData();
                
                console.log("Updating dashboard...");
                await update_purity_data(JSON.stringify(PURITY_DATA));
                await update_potency_data(JSON.stringify(POTENCY_DATA));
                await update_activity_data(JSON.stringify(ACTIVITY_DATA));
                
                document.getElementById('loading').style.display = 'none';
            } catch (e) {
                console.error("Dashboard Error:", e);
                document.getElementById('status').textContent = e.toString();
            }
        }
    
        // Start the application
        window.addEventListener('load', initializeDashboard);

        // Render functions
        function renderProductInfo() {
            const content = Object.entries(PRODUCT_INFO).map(([key, value]) => `
                <div class="mb-2">
                    <span class="font-semibold">${key}:</span> ${value}
                </div>
            `).join('');
            document.getElementById('product-content').innerHTML = content;
        }

        function renderPurityData() {
            const content = `
                <table class="min-w-full">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="px-4 py-2 text-left">Description</th>
                            <th class="px-4 py-2 text-left">Specification</th>
                            <th class="px-4 py-2 text-left">Result</th>
                            <th class="px-4 py-2 text-left">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${PURITY_DATA.map(item => `
                            <tr class="border-t">
                                <td class="px-4 py-2">${item.description}</td>
                                <td class="px-4 py-2">${item.specification}</td>
                                <td class="px-4 py-2">${item.result}</td>
                                <td class="px-4 py-2">
                                    <span class="px-2 py-1 rounded-full text-sm ${item.pass_fail === 'Pass' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                        ${item.pass_fail}
                                    </span>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('purity-content').innerHTML = content;
        }

        function renderPotencyData() {
            const content = `
                <table class="min-w-full">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="px-4 py-2 text-left">Strain</th>
                            <th class="px-4 py-2 text-left">Specification</th>
                            <th class="px-4 py-2 text-left">Result</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${POTENCY_DATA.map(item => `
                            <tr class="border-t">
                                <td class="px-4 py-2">${item.strain}</td>
                                <td class="px-4 py-2">${item.specification}</td>
                                <td class="px-4 py-2">${item.result}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('potency-content').innerHTML = content;
        }

        function renderActivityData() {
            const content = `
                <table class="min-w-full">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="px-4 py-2 text-left">Time</th>
                            <th class="px-4 py-2 text-left">pH</th>
                            <th class="px-4 py-2 text-left">Lactic Acid</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${ACTIVITY_DATA.map(item => `
                            <tr class="border-t">
                                <td class="px-4 py-2">${item.time}</td>
                                <td class="px-4 py-2">${item.ph}</td>
                                <td class="px-4 py-2">${item.lactic_acid}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('activity-content').innerHTML = content;
        }

        // Initialize dashboard
        function initializeDashboard() {
            renderProductInfo();
            renderPurityData();
            renderPotencyData();
            renderActivityData();
            document.getElementById('loading').style.display = 'none';
        }

        // Start the application
        window.addEventListener('load', initializeDashboard);
    </script>
</body>
</html>
